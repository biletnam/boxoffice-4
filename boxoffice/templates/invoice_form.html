{% extends "layout.html" %}
{% block title %}{{ org.title }}{% endblock %}
{% block headerbox %}
{% endblock %}

{% block headline %}
{% endblock %}

{% block content %}
  <div class="org-header">
    {%- if org.details.get('logo') %}
      <div class="organization-logo">
       <img src="{{org.details.get('logo')}}" />
      </div>
    {%- endif %}
    <h1 class="item-collection-title">{{ order.item_collection.title }}</h1>
    <p class="text-center">Receipt No: {{ order.invoice_no }}</p>
  </div>

  <div class="row" id="boxoffice-invoice">
    {%- raw %}
      <script id='boxoffice-invoice-form-template' type='text/ractive'>
        {{#each invoices}}
          <div class="ticket col-xs-12 {{#if invoices.length > 1}}col-sm-6{{else}}col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3{{/if}}">
            <div class="content-box clearfix" intro='fly:{"x":20,"y":"0"}'>
              {{#if !hideForm}}
                <h4 class="text-center attendee-form-title">If you need a GST invoice, please fill in the details below.</h4> 
                  <form class="attendee-form" role="form" name="invoice-details-form-{{ id }}" id="invoice-{{ id }}">
                    <div class="group">
                      <input class="group-input {{#buyer_taxid}}filled{{/}}" type="text" name="buyer_taxid" value="{{ buyer_taxid }}">
                      <span class="bar"></span>
                      <label class="group-label">GSTIN</label>
                      {{#errormsg.buyer_taxid}}<p class="form-error-msg">{{ errormsg.buyer_taxid }}</p>{{/}}
                    </div>
                    <div class="group">
                      <input class="group-input {{#invoicee_name}}filled{{/}}" type="text" name="invoicee_name" value="{{ invoicee_name }}">
                      <span class="bar"></span>
                      <label class="group-label">Name</label>
                      {{#errormsg.invoicee_name}}<p class="form-error-msg">{{ errormsg.invoicee_name }}</p>{{/}}
                    </div>
                    <div class="group">
                      <input class="group-input {{#invoicee_email}}filled{{/}}" type="text" name="invoicee_email" value="{{ invoicee_email }}">
                      <span class="bar"></span>
                      <label class="group-label">Email</label>
                      {{#errormsg.invoicee_email}}<p class="form-error-msg">{{ errormsg.invoicee_email }}</p>{{/}}
                    </div>
                    <div class="group">
                      <input class="group-input {{#street_address}}filled{{/}}" type="text" name="street_address" value="{{ street_address }}">
                      <label class="group-label">Street</label>
                      {{#errormsg.street_address}}<p class="form-error-msg">{{ errormsg.street_address }}</p>{{/}}
                    </div>
                    <div class="group-select inline-group left-group">
                      <select name="country_code" value="{{country_code}}">
                        {{#utils.countries}} {{# { country: . } }}
                          <option value="{{ country.code }}">{{ country.name }}</option>
                        {{/}}{{/utils.countries}}
                      </select>
                      {{#errormsg.country_code}}<p class="form-error-msg">{{ errormsg.country_code }}</p>{{/}}
                    </div>
                    {{#if country_code == "IN"}}
                      <div class="group-select inline-group right-group">
                        <select name="state_code" value="{{ state_code }}">
                          <option value="">Select a state</option>
                          {{#utils.states}} {{# { currentState: . } }}
                            <option value="{{ currentState.code }}">{{ currentState.name }}</option>
                          {{/}}{{/utils.states}}
                        </select>
                        {{#errormsg.state_code}}<p class="form-error-msg">{{ errormsg.state_code }}</p>{{/}}
                        <input class="hidden" type="radio" name="{{ state }}" value="" checked>
                      </div>
                    {{else}}
                      <div class="group inline-group right-group">
                        <input class="group-input right-group {{#state}}filled{{/}}" type="text" name="state" value="{{ state }}">
                        <span class="bar"></span>
                        <label class="group-label">State</label>
                        {{#errormsg.state}}<p class="form-error-msg">{{ errormsg.state }}</p>{{/}}
                        <input class="hidden" type="radio" name="{{ state_code }}" value="" checked>
                      </div>
                    {{/if}}
                    <div class="group inline-group left-group">
                      <input class="group-input {{#city}}filled{{/}}" type="text" name="city" value="{{ city }}">
                      <span class="bar"></span>
                      <label class="group-label">City</label>
                      {{#errormsg.city}}<p class="form-error-msg">{{ errormsg.city }}</p>{{/}}
                    </div>
                    <div class="group inline-group right-group">
                      <input class="group-input right-group {{#postcode}}filled{{/}}" type="text" name="postcode" value="{{ postcode }}">
                      <span class="bar"></span>
                      <label class="group-label">Pincode</label>
                      {{#errormsg.postcode}}<p class="form-error-msg">{{ errormsg.postcode }}</p>{{/}}
                    </div>
                    <div class="assign-btn-wrapper">
                      <button type="submit" class="boxoffice-button boxoffice-button-action" on-click="submitInvoiceDetails(event, event.keypath, id)" {{#submittingInvoiceDetails}}disabled{{/}}>
                        Submit {{#submittingInvoiceDetails}}<i class="fa fa-spinner fa-spin" intro='fly:{"x":0,"y":"0"}'>{{/}}
                      </button>
                    </div>
                  </form>
                  {{#errorMsg}}
                    <p class="error-msg">{{ errorMsg }}</p>
                  {{/}}
              {{else}}
                <p class="confirmation-msg">Thank you for submitting the details, we will mail you the invoice shortly.</p>
                <div class="assign-btn-wrapper">
                  <button type="submit" class="boxoffice-button boxoffice-button-info" on-click="showInvoiceForm(event, event.keypath)">Edit invoice details</button>
                </div>
              {{/if}}
            </div>
          </div>
        {{/each}}
      </script>
    {%- endraw %}
  </div>
{% endblock %}
{% block footerscripts %}
  <script src='/static/js/views/invoice.js'></script>
  <script type="text/javascript">
    $(document).ready(function () {
      Ractive.DEBUG = false;
      var states = {{ states | tojson }};
      var countries = {{ countries | tojson }};
      var invoices = {{ invoices | tojson }};
      var accessToken = "{{ order.access_token }}";
      window.Boxoffice.Invoice.init(invoices, accessToken, states, countries);
    });
  </script>
{% endblock %}
