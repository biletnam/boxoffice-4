{% extends "layout.html" %}
{% block title %}{{ org.title }}{% endblock %}
{% block headerbox %}
{% endblock %}

{% block headline %}
{% endblock %}

{% block content %}
  <div class="org-header">
    {%- if org.details.get('logo') %}
      <div class="organization-logo">
       <img src="{{org.details.get('logo')}}" />
      </div>
    {%- endif %}
    <h1 class="item-collection-title">{{ order.item_collection.title }}</h1>
    <p class="text-center">Receipt No: {{ order.invoice_no }}</p>
  </div>

  <div class="row" id="boxoffice-invoice">
    {%- raw %}
      <script id='boxoffice-invoice-form-template' type='text/ractive'>
        <div class="ticket col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3">
        <div class="content-box clearfix" intro='fly:{"x":20,"y":"0"}'>
          {{#if editDetails}}
            <h4 class="text-center attendee-form-title">If you need a GST invoice, please fill in the details below.</h4> 
            <form class="attendee-form" role="form" name="invoice-details-form">
              <div class="group">
                <input class="group-input {{#invoiceDetails.gstin}}filled{{/}}" type="text" name="gstin" value="{{invoiceDetails.gstin}}">
                <span class="bar"></span>
                <label class="group-label">GSTIN</label>
                {{#invoiceDetails.errormsg.gstin}}<p class="form-error-msg">{{ invoiceDetails.errormsg.gstin }}</p>{{/}}
              </div>
              <div class="group">
                <input class="group-input {{#invoiceDetails.name}}filled{{/}}" type="text" name="name" value="{{invoiceDetails.name}}">
                <span class="bar"></span>
                <label class="group-label">Name</label>
                {{#invoiceDetails.errormsg.name}}<p class="form-error-msg">{{ invoiceDetails.errormsg.name }}</p>{{/}}
              </div>
              <div class="group">
                <input class="group-input {{#invoiceDetails.email}}filled{{/}}" type="text" name="email" value="{{invoiceDetails.email}}">
                <span class="bar"></span>
                <label class="group-label">Email</label>
                {{#invoiceDetails.errormsg.email}}<p class="form-error-msg">{{ invoiceDetails.errormsg.email }}</p>{{/}}
              </div>
              <div class="group">
                <input class="group-input {{#invoiceDetails.street}}filled{{/}}" type="text" name="street" value="{{invoiceDetails.street}}">
                <label class="group-label">Street</label>
                {{#invoiceDetails.errormsg.street}}<p class="form-error-msg">{{ invoiceDetails.errormsg.street }}</p>{{/}}
              </div>
              <div class="group inline-group left-group">
                <input class="group-input {{#invoiceDetails.city}}filled{{/}}" type="text" name="city" value="{{invoiceDetails.city}}">
                <span class="bar"></span>
                <label class="group-label">City</label>
                {{#invoiceDetails.errormsg.city}}<p class="form-error-msg">{{ invoiceDetails.errormsg.city }}</p>{{/}}
              </div>
              <div class="group inline-group right-group">
                <input class="group-input right-group {{#invoiceDetails.pincode}}filled{{/}}" type="text" name="pincode" value="{{invoiceDetails.pincode}}">
                <span class="bar"></span>
                <label class="group-label">Postcode</label>
                {{#invoiceDetails.errormsg.pincode}}<p class="form-error-msg">{{ invoiceDetails.errormsg.pincode }}</p>{{/}}
              </div>
              <div class="group-select inline-group left-group">
                <select name="country" value="{{invoiceDetails.countryCode}}">
                  {{#utils.countries}} {{# { country: . } }}
                    <option value="{{country.code}}">{{country.name}}</option>
                  {{/}}{{/utils.countries}}
                </select>
                {{#invoiceDetails.errormsg.country}}<p class="form-error-msg">{{ invoiceDetails.errormsg.country }}</p>{{/}}
              </div>
              {{#if invoiceDetails.countryCode == "IN"}}
                <div class="group-select inline-group right-group">
                  <select name="state" value="{{invoiceDetails.stateCode}}">
                    {{#utils.states}} {{# { currentState: . } }}
                      <option value="{{currentState.code}}">{{currentState.name}}</option>
                    {{/}}{{/utils.states}}
                  </select>
                  {{#invoiceDetails.errormsg.state}}<p class="form-error-msg">{{ invoiceDetails.errormsg.state }}</p>{{/}}
                  <input class="hidden" type="radio" name="{{invoiceDetails.state}}" value="" checked>
                </div>
              {{else}}
                <div class="group inline-group right-group">
                  <input class="group-input right-group {{#invoiceDetails.state}}filled{{/}}" type="text" name="state" value="{{invoiceDetails.state}}">
                  <span class="bar"></span>
                  <label class="group-label">State</label>
                  {{#invoiceDetails.errormsg.state}}<p class="form-error-msg">{{ invoiceDetails.errormsg.state }}</p>{{/}}
                  <input class="hidden" type="radio" name="{{invoiceDetails.stateCode}}" value="" checked>
                </div>
              {{/if}}
              <div class="assign-btn-wrapper">
                <button type="submit" class="boxoffice-button boxoffice-button-action" on-click="submitInvoiceDetails(event)" {{#submittingInvoiceDetails}}disabled{{/}}>
                  Submit {{#submittingInvoiceDetails}}<i class="fa fa-spinner fa-spin" intro='fly:{"x":0,"y":"0"}'>{{/}}
                </button>
              </div>
            </form>
            {{#errorMsg}}
              <p class="error-msg">{{ errorMsg }}</p>
            {{/}}
          {{else}}
            <p class="confirmation-msg">Thank you for submitting the details, we will mail you the invoice shortly.</p>
            <div class="assign-btn-wrapper">
              <button type="submit" class="boxoffice-button boxoffice-button-info" on-click='toggle("editDetails")'>Edit invoice details</button>
            </div>
          {{/if}}
          </div>
        </div>
      </script>
    {%- endraw %}
  </div>
{% endblock %}
{% block footerscripts %}
  <script src='/static/js/views/invoice.js'></script>
  <script type="text/javascript">
    $(document).ready(function () {
      Ractive.DEBUG = false;
      var states = {{ states | tojson }};
      var countries = {{ countries | tojson }};
      var invoice = {};
      invoice.orderId = "{{ order.id }}";
      invoice.gstin = "{{ invoice.buyer_taxid | default('', true) }}";
      invoice.name = "{{ invoice.invoicee_name | default('', true)  }}";
      invoice.email = "{{ invoice.invoicee_email | default('', true)  }}";
      invoice.street = "{{ invoice.street_address | default('', true)  }}";
      invoice.city = "{{ invoice.city | default('', true)  }}";
      invoice.pincode = "{{ invoice.postcode  | default('', true)  }}";
      invoice.countryCode = "{{ invoice.country_code | default('IN') }}";
      invoice.stateCode = "{{ invoice.state_code  | default('KA')  }}";
      invoice.state = "{{ invoice.state | default('', true) }}";
      window.Boxoffice.Invoice.init(invoice, states, countries);
    });
  </script>
{% endblock %}
